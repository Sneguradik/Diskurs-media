{"version":3,"sources":["webpack:///src/app/modules/homepage/pages/popular-page/popular-page-routing.module.ts","webpack:///src/app/modules/homepage/pages/popular-page/popular-page.module.ts","webpack:///src/app/shared/functions/fetch-articles-with-topics.function.ts","webpack:///src/app/shared/classes/pageable-conetnt.class.ts","webpack:///src/app/modules/homepage/pages/popular-page/popular-feed-item.class.ts","webpack:///src/app/modules/homepage/pages/popular-page/popular-page.component.ts","webpack:///src/app/modules/homepage/pages/popular-page/popular-page.component.html"],"names":["routes","path","redirectTo","component","PopularPageRoutingModule","forChild","imports","exports","PopularPageModule","declarations","fetchArticlesWithTopics$","page","topicsService","topics","content","forEach","article","length","push","getMultiple$","pipe","topicsRet","find","x","meta","id","NO_CONTENT","Symbol","PageableContent","fetchNextFn$","options","isFetching$","content$","end$","totalPages","fetchCommand$","options$","_","subscribe","fetchNextPage","fetch","next","reset$","hard","it","splice","setOptionsWithReset$","value","response","error","PopularFeedItem","articleView","range","empty","realIndex","isArticle","isRange","isEmpty","PopularPageComponent","feedService","advertisementService","platformService","administrationService","homepageService","sidebarWrapperService","activatedRoute","router","responsive","count","choice","pageable","fetch$","bind","pageAttempt$","adNums","adViewedProps","ads","currentPage","contentLoading","ngOnInit","setTimeout","params$","trending","navigation","live","showSidebar","getEventsJobs$","ngOnDestroy$","eventsJobs","feedSource$","POPULAR","setRange","isBrowser","getAd","onScroll","adElem1","adViewed","adElem2","adElem3","range$","url","getRange","before$","findRange$","Date","now","start","acc","count$","before","a","b","ngOnDestroy","NONE","after","name","DAY","result","Number","isFinite","undefined","feedRequest$","order","RATING","list","aPage","prefix","total","concat","map","c","counter","fetchAd","elem","get$","FEED1","FEED2","FEED3","localStorage","getItem","setItem","rect","nativeElement","getBoundingClientRect","viewHeight","Math","max","document","documentElement","clientHeight","window","innerHeight","bottom","top","view$","adClicked","click$","open","onHide","promote","includes","findIndex","item","filter","iter","selector","templateUrl","styleUrls"],"mappings":"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","file":"pages-popular-page-popular-page-module-es5.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport { PopularPageComponent } from './popular-page.component';\n\n\nconst routes: Routes = [\n  {\n    path: '',\n    redirectTo: 'day'\n  },\n  {\n    path: ':when',\n    component: PopularPageComponent\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule]\n})\nexport class PopularPageRoutingModule { }\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { PopularPageRoutingModule } from './popular-page-routing.module';\nimport { PopularPageComponent } from './popular-page.component';\nimport { FeedModule } from '@shared/modules/feed/feed.module';\nimport { SharedPipesModule } from '@shared/pipes/shared-pipes.module';\nimport { SharedComponentsModule } from '@shared/components/shared-components.module';\nimport { SvgModule } from '@shared/modules/svg/svg.module';\nimport { ShortJobListModule } from '@shared/modules/short-job-list/short-job-list.module';\nimport { ShortEventListModule } from '@shared/modules/short-event-list/short-event-list.module';\nimport { TranslateModule } from '@ngx-translate/core';\n\n\n@NgModule({\n  declarations: [PopularPageComponent],\n  imports: [\n    CommonModule,\n    PopularPageRoutingModule,\n    FeedModule,\n    SharedPipesModule,\n    SharedComponentsModule,\n    SvgModule,\n    ShortJobListModule,\n    ShortEventListModule,\n    TranslateModule,\n  ]\n})\nexport class PopularPageModule { }\n","import { Observable, of } from 'rxjs';\nimport { IArticleView } from '@api/schemas/article/article-view.interface';\nimport { IPageResponse } from '@api/schemas/page/page-response.interface';\nimport { ITopicView } from '@api/schemas/topic/topic-view.interface';\nimport { ITopicViewFull } from '@api/schemas/topic/topic-view-full.interface';\nimport { map, defaultIfEmpty } from 'rxjs/operators';\nimport { TopicsService } from '@api/routes/topics.service';\n\nexport function fetchArticlesWithTopics$(\n  page: IPageResponse<IArticleView>,\n  topicsService: TopicsService\n): Observable<IPageResponse<[IArticleView, ITopicView]>> {\n    const topics: number[] = [];\n    page.content.forEach((article: IArticleView) => {\n        if (article.topics.length > 0) {\n            topics.push(article.topics[0]);\n        }\n    });\n    return page.content.length > 0 ? topicsService.getMultiple$(topics).pipe(defaultIfEmpty([]), map((topicsRet: ITopicViewFull[]) => {\n        const content: [IArticleView, ITopicView][] = [];\n        page.content.forEach((article: IArticleView) => {\n            if (article.topics.length > 0) {\n                content.push([article, topicsRet.find((x: ITopicViewFull) => x.meta.id === article.topics[0]) as ITopicView]);\n            } else {\n                content.push([article, null]);\n            }\n        });\n        return { ...page, content };\n    })) : of({ ...page, content: [] });\n}\n","import { BehaviorSubject, Subject, Observable } from 'rxjs';\nimport { IPageResponse } from '@api/schemas/page/page-response.interface';\nimport { debounce, filter, first, tap, mapTo } from 'rxjs/operators';\n\nexport const NO_CONTENT = Symbol('NO_CONTENT');\n\nexport class PageableContent<T, O = any> {\n  public readonly isFetching$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n  public readonly content$: Subject<T[]> = new Subject<T[]>();\n  public readonly options$: BehaviorSubject<O>;\n  public readonly end$ = new Subject();\n\n  public content: T[] = [];\n  public page = -1;\n  public totalPages = 1;\n\n  private readonly fetchCommand$: Subject<never> = new Subject<never>();\n\n  constructor(\n    private readonly fetchNextFn$: (page: number, options: O) => Observable<IPageResponse<T>>,\n    options: O = null\n  ) {\n    this.options$ = new BehaviorSubject<O>(options);\n    this.fetchCommand$.pipe(debounce(() => this.isFetching$.pipe(filter((_: boolean) => !_)))).subscribe(() => this.fetchNextPage());\n  }\n\n  public fetch(): void {\n    if (this.page < this.totalPages - 1) {\n      this.fetchCommand$.next();\n    }\n  }\n\n  public reset$(hard: boolean = true): Observable<any> {\n    return this.isFetching$.pipe(\n      filter((it: boolean) => !it),\n      first(),\n      tap(() => {\n        if (hard) {\n          this.content.splice(0, this.content.length);\n        }\n        this.page = -1;\n        this.totalPages = 1;\n      }),\n    );\n  }\n\n  public setOptionsWithReset$(options: O, hard: boolean = true): Observable<O> {\n    return this.reset$(hard).pipe(\n      tap(() => {\n        this.options$.next(options);\n        this.fetch();\n      }),\n      mapTo(options),\n    );\n  }\n\n  private fetchNextPage(): void {\n    this.isFetching$.next(true);\n    this.fetchNextFn$(this.page + 1, this.options$.value).subscribe(\n      (response: IPageResponse<T>) => {\n        this.page = response.page;\n        this.totalPages = response.totalPages;\n        this.content$.next(response.content);\n        if (this.page >= this.totalPages - 1) {\n          this.end$.next();\n        }\n        this.content.push(...response.content);\n        this.isFetching$.next(false);\n      },\n      (error: any) => {\n        this.isFetching$.next(false);\n        if (error !== Symbol('NO_CONTENT')) {\n          throw error;\n        }\n      },\n    );\n  }\n}\n","import { IArticleView } from '@api/schemas/article/article-view.interface';\nimport { ITopicView } from '@api/schemas/topic/topic-view.interface';\n\nexport class PopularFeedItem {\n    constructor(\n        public readonly articleView: [IArticleView, ITopicView] = null,\n        public readonly range: {\n            before: number;\n            after: number;\n        } = null,\n        public readonly empty: boolean = null,\n        public readonly realIndex: number = -1,\n    ) {}\n\n    public isArticle(): boolean {\n        return this.articleView !== null;\n    }\n\n    public isRange(): boolean {\n        return this.range !== null;\n    }\n\n    public isEmpty(): boolean {\n        return this.empty;\n    }\n}\n","import { Component, OnInit, OnDestroy, ViewChild, ElementRef, HostListener } from '@angular/core';\nimport { FeedService } from '@api/routes/feed.service';\nimport { TopicsService } from '@api/routes/topics.service';\nimport { HomepageService } from '@shared/services/homepage.service';\nimport { SidebarWrapperService } from '@layout/sidebar-wrapper/sidebar-wrapper.service';\nimport { PageableContent } from '@shared/classes/pageable-conetnt.class';\nimport { FeedSourceEnum } from '@shared/enums/feed-source.enum';\nimport { Observable, Subject, of, throwError, concat, EMPTY, combineLatest } from 'rxjs';\nimport { PopularFeedItem } from './popular-feed-item.class';\nimport {\n  map,\n  distinct,\n  mergeScan,\n  switchAll,\n  debounce,\n  startWith,\n  takeUntil,\n  pairwise,\n  switchMap,\n  mergeMap\n} from 'rxjs/operators';\nimport { IPageResponse } from '@api/schemas/page/page-response.interface';\nimport { FeedOrderEnum } from '@api/schemas/feed/feed-order.enum';\nimport { IArticleView } from '@api/schemas/article/article-view.interface';\nimport { fetchArticlesWithTopics$ } from '@shared/functions/fetch-articles-with-topics.function';\nimport { ITopicView } from '@api/schemas/topic/topic-view.interface';\nimport { ActivatedRoute, UrlSegment, Router } from '@angular/router';\nimport { AbstractComponent } from '@shared/classes/abstract-component.class';\nimport { IEventsJobsControl } from '@api/schemas/dashboard/events-jobs-control.interface';\nimport { AdministrationService } from '@api/routes/administration.service';\nimport { IBannerPageableContent } from '@modules/dashboard/pages/ads-management-page/banner-pageable-content.interface';\nimport { BannerPlaceEnum } from '@api/schemas/advertisement/banner-place.enum';\nimport { IBannerReturnView } from '@api/schemas/advertisement/banner-return-view.interface';\nimport { AdvertisementService } from '@api/routes/advertisement.service';\nimport { PlatformService } from '@shared/services/platform.service';\nimport { ResponsiveService } from '@app/services/responsive.service';\n\n@Component({\n  selector: 'app-popular-page',\n  templateUrl: './popular-page.component.html',\n  styleUrls: ['./popular-page.component.scss']\n})\nexport class PopularPageComponent extends AbstractComponent implements OnInit, OnDestroy {\n  @ViewChild('adElem1', { static: false }) private adElem1: ElementRef;\n  @ViewChild('adElem2', { static: false }) private adElem2: ElementRef;\n  @ViewChild('adElem3', { static: false }) private adElem3: ElementRef;\n\n  private before$: Observable<number>;\n  private range$: Observable<number>;\n  private count = 0;\n  private choice = false;\n\n  public readonly pageable = new PageableContent<PopularFeedItem, [number, number]>(this.fetch$.bind(this));\n  public readonly pageAttempt$: Subject<void> = new Subject<void>();\n\n  public eventsJobs: IEventsJobsControl;\n\n  public ads: IBannerPageableContent[];\n  public adNums: number[] = [0, 0, 0];\n  public adViewedProps: boolean[] = [false, false, false];\n\n  constructor(\n    protected readonly feedService: FeedService,\n    protected readonly topicsService: TopicsService,\n    protected readonly advertisementService: AdvertisementService,\n    protected readonly platformService: PlatformService,\n    private readonly administrationService: AdministrationService,\n    private readonly homepageService: HomepageService,\n    private readonly sidebarWrapperService: SidebarWrapperService,\n    private readonly activatedRoute: ActivatedRoute,\n    private readonly router: Router,\n    public readonly responsive: ResponsiveService\n  ) {\n    super();\n    this.ads = [\n      {\n        content: [],\n        currentPage: 0,\n        totalPages: 1,\n        contentLoading: false,\n      },\n      {\n        content: [],\n        currentPage: 0,\n        totalPages: 1,\n        contentLoading: false,\n      },\n      {\n        content: [],\n        currentPage: 0,\n        totalPages: 1,\n        contentLoading: false,\n      },\n    ];\n  }\n\n  ngOnInit(): void {\n    setTimeout(() => {\n      this.sidebarWrapperService.params$.next({ article: false, trending: true, navigation: true, live: true, showSidebar: true });\n    });\n    this.administrationService.getEventsJobs$().pipe(takeUntil(this.ngOnDestroy$)).subscribe((_: IEventsJobsControl) => {\n      this.eventsJobs = _;\n    });\n    this.homepageService.feedSource$.next(FeedSourceEnum.POPULAR);\n    this.setRange();\n    if (this.platformService.isBrowser) {\n      this.getAd();\n    }\n  }\n\n  @HostListener('window:scroll', ['$event']) public onScroll(): void {\n    if (!this.adViewedProps[0] && this.ads[0].content[0] && this.adElem1) {\n      this.adViewed(0);\n    }\n    if (!this.adViewedProps[1] && this.ads[1].content[0] && this.adElem2) {\n      this.adViewed(1);\n    }\n    if (!this.adViewedProps[2] && this.ads[2].content[0] && this.adElem3) {\n      this.adViewed(2);\n    }\n  }\n\n  private setRange(): void {\n    this.range$ = this.activatedRoute.url.pipe(\n      map((url: UrlSegment[]) => {\n        this.choice = url[0].path === 'editorschoice';\n        return url[0] ? this.getRange(url[0].path) : null;\n      }),\n    );\n\n    this.before$ = this.range$.pipe(\n      map((range: number) => {\n        return this.findRange$(Date.now(), range).pipe(\n          mergeMap((start: number) => {\n            return concat(\n              of(start),\n              this.pageAttempt$.pipe(\n                distinct(() => 1, this.pageable.end$),\n                mergeScan((acc: number) => {\n                  return this.choice ? null : this.feedService.count$({ before: acc - range }).pipe(\n                    mergeMap((count: number) => {\n                      return count === 0 ? EMPTY : this.findRange$(acc - range, range);\n                    }),\n                  );\n                }, start),\n              ),\n            );\n          }),\n        );\n      }),\n      switchAll(),\n    );\n\n    combineLatest([\n      this.before$,\n      this.range$.pipe(debounce(() => this.before$))\n    ]).pipe(\n      startWith(null as [number, number]),\n      pairwise(),\n      mergeMap(([a, b]: [[number, number], [number, number]]) => {\n        this.homepageService.feedSource$.next(FeedSourceEnum.POPULAR);\n        return this.pageable.setOptionsWithReset$(b, !a || !a[1] || a[1] !== b[1]);\n      }),\n      takeUntil(this.ngOnDestroy$),\n    ).subscribe();\n  }\n\n  ngOnDestroy(): void {\n    this.homepageService.feedSource$.next(FeedSourceEnum.NONE);\n    super.ngOnDestroy();\n  }\n\n  private findRange$(before: number, range: number): Observable<number> {\n    return this.feedService.count$({ before, after: before - range }).pipe(\n      switchMap((count: number) => {\n        return count === 0 && (range && range > 0) ? this.findRange$(before - range, range) : of(before);\n      }),\n      takeUntil(this.ngOnDestroy$)\n    );\n  }\n\n  private getRange(name: string): number {\n    const DAY: number = 1000 * 60 * 60 * 24;\n    switch (name) {\n      case 'year':\n        return DAY * 365;\n      case 'month':\n        return DAY * 30;\n      case 'week':\n        return DAY * 7;\n      case 'three-days':\n        return DAY * 3;\n      case 'day':\n        return DAY;\n      default:\n        return null;\n    }\n  }\n\n  private fetch$(page: number, options: [number, number]): Observable<IPageResponse<PopularFeedItem>> {\n    let result: Observable<any>;\n    if (options) {\n      const [before, range]: [number, number] = options;\n      const after: number = Number.isFinite(range) ? (before - range) : undefined;\n\n      result = this.feedService.feedRequest$({\n        page, before, after, order: !this.choice ? FeedOrderEnum.RATING : undefined, list: this.choice ? 'default' : undefined\n      }).pipe(\n        mergeMap((aPage: IPageResponse<IArticleView>) => fetchArticlesWithTopics$(aPage, this.topicsService)),\n        map((response: IPageResponse<[IArticleView, ITopicView]>) => {\n          const prefix = response.page === 0 && after ? [new PopularFeedItem(null, { before, after })] : [];\n          return response.page === 0 && response.total === 0\n            ? { ...response, content: [...prefix, new PopularFeedItem(null, null, true)] }\n            : {\n              ...response,\n              content: prefix.concat(response.content.map((c: [IArticleView, ITopicView]) =>\n                new PopularFeedItem(c, null, null, this.counter()))),\n            };\n        }),\n      );\n    } else {\n      result = throwError(Symbol('NO_CONTENT'));\n    }\n    return result;\n  }\n\n  public getAd(): void {\n    this.fetchAd(0);\n    this.fetchAd(1);\n    this.fetchAd(2);\n  }\n\n  public fetchAd(elem: number): void {\n    if ((this.ads[elem].content === [] || this.ads[elem].currentPage + 1 <= this.ads[elem].totalPages)\n      && !this.ads[elem].contentLoading) {\n      this.ads[elem].contentLoading = true;\n      this.advertisementService.get$(\n        this.ads[elem].currentPage,\n        elem === 0 ? BannerPlaceEnum.FEED1 : elem === 1 ? BannerPlaceEnum.FEED2 : BannerPlaceEnum.FEED3\n      ).pipe(takeUntil(this.ngOnDestroy$)).subscribe((_: IPageResponse<IBannerReturnView>) => {\n        this.ads[elem].content.push(..._.content);\n        this.ads[elem].totalPages = _.totalPages;\n        this.ads[elem].currentPage++;\n        this.ads[elem].contentLoading = false;\n        if (this.ads[elem].currentPage + 1 <= this.ads[elem].totalPages) {\n          this.getAd();\n        } else {\n          if (this.ads[elem].content[0]) {\n            if (!localStorage.getItem('ad-feed' + elem)) {\n              localStorage.setItem('ad-feed' + elem, '1');\n              this.adNums[elem] = 0;\n            } else {\n              this.adNums[elem] = Number(localStorage.getItem('ad-feed' + elem)) - 1;\n              if (this.adNums[elem] + 1 < this.ads[elem].content.length) {\n                this.adNums[elem]++;\n              } else {\n                this.adNums[elem] = 0;\n              }\n              localStorage.setItem('ad-feed' + elem, this.adNums[elem] + 1 + '');\n            }\n          }\n        }\n      });\n    }\n  }\n\n  public adViewed(elem: number): void {\n    let rect: any;\n    switch (elem) {\n      case 0:\n        rect = this.adElem1.nativeElement.getBoundingClientRect();\n        break;\n      case 1:\n        rect = this.adElem2.nativeElement.getBoundingClientRect();\n        break;\n      case 2:\n        rect = this.adElem3.nativeElement.getBoundingClientRect();\n        break;\n    }\n    const viewHeight: number = Math.max(document.documentElement.clientHeight, window.innerHeight);\n    if (!(rect.bottom < 0 || rect.top - viewHeight >= 0) && !this.adViewedProps[elem]) {\n      this.advertisementService.view$(this.ads[elem].content[this.adNums[elem]].id)\n        .pipe(takeUntil(this.ngOnDestroy$))\n        .subscribe();\n      this.adViewedProps[elem] = true;\n    }\n  }\n\n  public adClicked(elem: number): void {\n    this.advertisementService.click$(this.ads[elem].content[this.adNums[elem]].id)\n      .pipe(takeUntil(this.ngOnDestroy$))\n      .subscribe(() => {\n        window.open(this.ads[elem].content[this.adNums[elem]].url, '_blank');\n    });\n  }\n\n  public counter(): number {\n    return this.count++;\n  }\n\n  public onHide(article: IArticleView, promote?: boolean): void {\n    if (promote && this.router.url.includes('editorschoice') || !promote) {\n      this.pageable.content.splice(\n        this.pageable.content.findIndex((item: PopularFeedItem) => item.isArticle() && item.articleView[0].meta.id === article.meta.id),\n        1,\n      );\n    }\n  }\n\n  public findIndex(item: PopularFeedItem): number {\n    if (item.isArticle()) {\n      return this.pageable.content.filter(\n        (iter: PopularFeedItem) => iter.isArticle()\n      ).findIndex((iter: PopularFeedItem) => iter.articleView[0].meta.id === item.articleView[0].meta.id) + 1;\n    }\n    return -1;\n  }\n}\n","<ul class=\"block-card item-space-20 no-empty\">\n    <li *ngFor=\"let item of pageable.content; let i = index\">\n        <ng-container [ngSwitch]=\"true\">\n            <ng-container *ngSwitchCase=\"item.isArticle()\">\n                <app-feed-article-view [data]=\"item.articleView[0]\" [topic]=\"item.articleView[1]\" [options]=\"{ pictureOn: true, menuOn: true }\" (gone)=\"onHide($event)\" (gonePromote)=\"onHide($event, true)\"></app-feed-article-view>\n            </ng-container>\n            <ng-container *ngSwitchCase=\"item.isRange()\">\n                <div class=\"caption fade-2 text-center\">{{'COMMON.PUBLICATIONS_PERIOD' | translate}} {{ item.range.after | customDate:true }} - {{ item.range.before | customDate:true }}</div>\n            </ng-container>\n            <ng-container *ngSwitchCase=\"item.isEmpty()\">\n                <div class=\"subtitle-2 fade-3 text-center\">Нет публикаций</div>\n            </ng-container>\n        </ng-container>\n        <div #adElem1 (click)=\"adClicked(0)\" class=\"ad\" *ngIf=\"(ads && ads[0].content && ads[0].content[0]) && ads[0].content[adNums[0]].afterPublication - 1 === (i + 1)\">\n            <ng-container [ngTemplateOutlet]=\"addContainer\" [ngTemplateOutletContext]=\"{ src: ads[0].content[adNums[0]].picture, text: ads[0].content[adNums[0]].text }\"></ng-container>\n        </div>\n        <div #adElem2 (click)=\"adClicked(1)\" class=\"ad\" *ngIf=\"(ads && ads[1].content && ads[1].content[0]) && ads[1].content[adNums[1]].afterPublication - 1 === (i + 1)\">\n            <ng-container [ngTemplateOutlet]=\"addContainer\" [ngTemplateOutletContext]=\"{ src: ads[1].content[adNums[1]].picture, text: ads[1].content[adNums[1]].text }\"></ng-container>\n        </div>\n        <div #adElem3 (click)=\"adClicked(2)\" class=\"ad\" *ngIf=\"(ads && ads[2].content && ads[2].content[0]) && ads[2].content[adNums[2]].afterPublication - 1 === (i + 1)\">\n            <ng-container [ngTemplateOutlet]=\"addContainer\" [ngTemplateOutletContext]=\"{ src: ads[2].content[adNums[2]].picture, text: ads[2].content[adNums[2]].text }\"></ng-container>\n        </div>\n        <app-events *ngIf=\"(i + 1) === eventsJobs.firstView.events && eventsJobs.popular.events\" [page]=\"0\" [blueClass]=\"'blue-events'\"></app-events>\n        <app-events *ngIf=\"(i + 1) === eventsJobs.secondView.events && eventsJobs.popular.events\" [page]=\"1\" [blueClass]=\"'blue-events'\"></app-events>\n        <app-events *ngIf=\"(i + 1) === eventsJobs.thirdView.events && eventsJobs.popular.events\" [page]=\"2\" [blueClass]=\"'blue-events'\"></app-events>\n        <app-jobs *ngIf=\"(i + 1) === eventsJobs.firstView.jobs && eventsJobs.popular.jobs\" [page]=\"0\"></app-jobs>\n        <app-jobs *ngIf=\"(i + 1) === eventsJobs.secondView.jobs && eventsJobs.popular.jobs\" [page]=\"1\"></app-jobs>\n        <app-jobs *ngIf=\"(i + 1) === eventsJobs.thirdView.jobs && eventsJobs.popular.jobs\" [page]=\"2\"></app-jobs>\n    </li>\n</ul>\n\n<app-pagination [pageable]=\"pageable\" (onPageAttempt)=\"pageAttempt$.next()\"></app-pagination>\n\n<ng-template #addContainer let-src=\"src\" let-text=\"text\">\n    <img [src]=\"src\" alt=\"\">\n    <div class=\"ad-container\">\n        <div class=\"ad-btn\" *ngIf=\"!(responsive.lt.medium | async)\">\n            <span>{{ text }}</span>\n            <svg name=\"chevron/right\" size=\"25\" fill=\"#92929D\"></svg>\n        </div>\n    </div>\n</ng-template>\n"]}