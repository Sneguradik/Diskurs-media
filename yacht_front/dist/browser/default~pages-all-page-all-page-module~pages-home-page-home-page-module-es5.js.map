{"version":3,"sources":["webpack:///src/app/shared/classes/feed-component.class.ts","webpack:///src/app/shared/functions/fetch-articles-with-topics.function.ts","webpack:///src/app/shared/classes/pageable-conetnt.class.ts"],"names":["FeedComponent","feedService","topicsService","administrationService","activatedRoute","advertisementService","platformService","adNums","adViewedProps","feed","publications","ads","content","currentPage","totalPages","contentLoading","onScroll","adElem1","adViewed","adElem2","adElem3","ngOnInit","getEventsJobs$","pipe","ngOnDestroy$","subscribe","_","eventsJobs","url","toString","isBrowser","getAd","fetch$","page","options","feedRequest$","article","fetchAd","elem","get$","FEED1","FEED2","FEED3","push","localStorage","getItem","setItem","Number","length","rect","nativeElement","getBoundingClientRect","viewHeight","Math","max","document","documentElement","clientHeight","window","innerHeight","bottom","top","view$","id","adClicked","click$","open","template","fetchArticlesWithTopics$","topics","forEach","getMultiple$","topicsRet","find","x","meta","NO_CONTENT","Symbol","PageableContent","fetchNextFn$","isFetching$","content$","end$","fetchCommand$","options$","fetchNextPage","fetch","next","reset$","hard","it","splice","setOptionsWithReset$","value","response","error"],"mappings":"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","file":"default~pages-all-page-all-page-module~pages-home-page-home-page-module-es5.js","sourcesContent":["import { IFeedParams } from '@api/schemas/feed/feed-params.interface';\nimport { Observable } from 'rxjs';\nimport { IPageResponse } from '@api/schemas/page/page-response.interface';\nimport { IArticleView } from '@api/schemas/article/article-view.interface';\nimport { ITopicView } from '@api/schemas/topic/topic-view.interface';\nimport { switchMap, takeUntil } from 'rxjs/operators';\nimport { FeedService } from '@api/routes/feed.service';\nimport { TopicsService } from '@api/routes/topics.service';\nimport { AbstractComponent } from './abstract-component.class';\nimport { fetchArticlesWithTopics$ } from '@shared/functions/fetch-articles-with-topics.function';\nimport { IEventsJobsControl } from '@api/schemas/dashboard/events-jobs-control.interface';\nimport { AdministrationService } from '@api/routes/administration.service';\nimport { ActivatedRoute, UrlSegment } from '@angular/router';\nimport { Component, ElementRef, HostListener, OnInit, ViewChild } from '@angular/core';\nimport { IBannerPageableContent } from '@modules/dashboard/pages/ads-management-page/banner-pageable-content.interface';\nimport { AdvertisementService } from '@api/routes/advertisement.service';\nimport { BannerPlaceEnum } from '@api/schemas/advertisement/banner-place.enum';\nimport { IBannerReturnView } from '@api/schemas/advertisement/banner-return-view.interface';\nimport { PlatformService } from '@shared/services/platform.service';\n\n@Component({\n    template: ''\n})\nexport abstract class FeedComponent extends AbstractComponent implements OnInit {\n\n    @ViewChild('adElem1', { static: false }) private adElem1: ElementRef;\n    @ViewChild('adElem2', { static: false }) private adElem2: ElementRef;\n    @ViewChild('adElem3', { static: false }) private adElem3: ElementRef;\n\n    public ads: IBannerPageableContent[];\n    public adNums: number[] = [0, 0, 0];\n    public adViewedProps: boolean[] = [false, false, false];\n\n    public eventsJobs: IEventsJobsControl;\n    public feed = false;\n    public publications = false;\n\n    @HostListener('window:scroll', ['$event']) public onScroll(): void {\n        if (!this.adViewedProps[0] && this.ads[0].content[0] && this.adElem1) {\n            this.adViewed(0);\n        }\n        if (!this.adViewedProps[1] && this.ads[1].content[0] && this.adElem2) {\n            this.adViewed(1);\n        }\n        if (!this.adViewedProps[2] && this.ads[2].content[0] && this.adElem3) {\n            this.adViewed(2);\n        }\n    }\n\n    constructor(\n      protected readonly feedService: FeedService,\n      protected readonly topicsService: TopicsService,\n      protected readonly administrationService: AdministrationService,\n      protected readonly activatedRoute: ActivatedRoute,\n      protected readonly advertisementService: AdvertisementService,\n      protected readonly platformService: PlatformService\n    ) {\n        super();\n        this.ads = [\n            {\n                content: [],\n                currentPage: 0,\n                totalPages: 1,\n                contentLoading: false,\n            },\n            {\n                content: [],\n                currentPage: 0,\n                totalPages: 1,\n                contentLoading: false,\n            },\n            {\n                content: [],\n                currentPage: 0,\n                totalPages: 1,\n                contentLoading: false,\n            },\n        ];\n    }\n\n    ngOnInit(): void {\n        this.administrationService.getEventsJobs$().pipe(takeUntil(this.ngOnDestroy$)).subscribe((_: IEventsJobsControl) => {\n            this.eventsJobs = _;\n        });\n        this.activatedRoute.url.pipe(takeUntil(this.ngOnDestroy$)).subscribe((_: UrlSegment[]) => {\n            if (_.toString() === '') {\n                this.feed = true;\n            } else if (_.toString() === 'all') {\n                this.publications = true;\n            }\n        });\n        if (this.platformService.isBrowser) {\n            this.getAd();\n        }\n    }\n\n    protected fetch$(page: number, options: IFeedParams): Observable<IPageResponse<[IArticleView, ITopicView]>> {\n        return this.feedService.feedRequest$({ ...options, page })\n          .pipe(switchMap((article: IPageResponse<IArticleView>) => fetchArticlesWithTopics$(article, this.topicsService)));\n    }\n\n    public getAd(): void {\n        this.fetchAd(0);\n        this.fetchAd(1);\n        this.fetchAd(2);\n    }\n\n    public fetchAd(elem: number): void {\n        if ((this.ads[elem].content === [] || this.ads[elem].currentPage + 1 <= this.ads[elem].totalPages)\n          && !this.ads[elem].contentLoading) {\n            this.ads[elem].contentLoading = true;\n            this.advertisementService.get$(\n                this.ads[elem].currentPage,\n                elem === 0 ? BannerPlaceEnum.FEED1 : elem === 1 ? BannerPlaceEnum.FEED2 : BannerPlaceEnum.FEED3\n            ).pipe(takeUntil(this.ngOnDestroy$)).subscribe((_: IPageResponse<IBannerReturnView>) => {\n                this.ads[elem].content.push(..._.content);\n                this.ads[elem].totalPages = _.totalPages;\n                this.ads[elem].currentPage++;\n                this.ads[elem].contentLoading = false;\n                if (this.ads[elem].currentPage + 1 <= this.ads[elem].totalPages) {\n                    this.getAd();\n                } else {\n                    if (this.ads[elem].content[0]) {\n                        if (!localStorage.getItem('ad-feed' + elem)) {\n                            localStorage.setItem('ad-feed' + elem, '1');\n                            this.adNums[elem] = 0;\n                        } else {\n                            this.adNums[elem] = Number(localStorage.getItem('ad-feed' + elem)) - 1;\n                            if (this.adNums[elem] + 1 < this.ads[elem].content.length) {\n                                this.adNums[elem]++;\n                            } else {\n                                this.adNums[elem] = 0;\n                            }\n                            localStorage.setItem('ad-feed' + elem, this.adNums[elem] + 1 + '');\n                        }\n                    }\n                }\n            });\n        }\n    }\n\n    public adViewed(elem: number): void {\n        let rect: any;\n        switch (elem) {\n            case 0:\n                rect = this.adElem1.nativeElement.getBoundingClientRect();\n                break;\n            case 1:\n                rect = this.adElem2.nativeElement.getBoundingClientRect();\n                break;\n            case 2:\n                rect = this.adElem3.nativeElement.getBoundingClientRect();\n                break;\n        }\n        const viewHeight: number = Math.max(document.documentElement.clientHeight, window.innerHeight);\n        if (!(rect.bottom < 0 || rect.top - viewHeight >= 0) && !this.adViewedProps[elem]) {\n            this.advertisementService.view$(this.ads[elem].content[this.adNums[elem]].id)\n              .pipe(takeUntil(this.ngOnDestroy$))\n              .subscribe();\n            this.adViewedProps[elem] = true;\n        }\n    }\n\n    public adClicked(elem: number): void {\n        this.advertisementService.click$(this.ads[elem].content[this.adNums[elem]].id)\n          .pipe(takeUntil(this.ngOnDestroy$))\n          .subscribe(() => {\n            window.open(this.ads[elem].content[this.adNums[elem]].url, '_blank');\n        });\n    }\n}\n","import { Observable, of } from 'rxjs';\nimport { IArticleView } from '@api/schemas/article/article-view.interface';\nimport { IPageResponse } from '@api/schemas/page/page-response.interface';\nimport { ITopicView } from '@api/schemas/topic/topic-view.interface';\nimport { ITopicViewFull } from '@api/schemas/topic/topic-view-full.interface';\nimport { map, defaultIfEmpty } from 'rxjs/operators';\nimport { TopicsService } from '@api/routes/topics.service';\n\nexport function fetchArticlesWithTopics$(\n  page: IPageResponse<IArticleView>,\n  topicsService: TopicsService\n): Observable<IPageResponse<[IArticleView, ITopicView]>> {\n    const topics: number[] = [];\n    page.content.forEach((article: IArticleView) => {\n        if (article.topics.length > 0) {\n            topics.push(article.topics[0]);\n        }\n    });\n    return page.content.length > 0 ? topicsService.getMultiple$(topics).pipe(defaultIfEmpty([]), map((topicsRet: ITopicViewFull[]) => {\n        const content: [IArticleView, ITopicView][] = [];\n        page.content.forEach((article: IArticleView) => {\n            if (article.topics.length > 0) {\n                content.push([article, topicsRet.find((x: ITopicViewFull) => x.meta.id === article.topics[0]) as ITopicView]);\n            } else {\n                content.push([article, null]);\n            }\n        });\n        return { ...page, content };\n    })) : of({ ...page, content: [] });\n}\n","import { BehaviorSubject, Subject, Observable } from 'rxjs';\nimport { IPageResponse } from '@api/schemas/page/page-response.interface';\nimport { debounce, filter, first, tap, mapTo } from 'rxjs/operators';\n\nexport const NO_CONTENT = Symbol('NO_CONTENT');\n\nexport class PageableContent<T, O = any> {\n  public readonly isFetching$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n  public readonly content$: Subject<T[]> = new Subject<T[]>();\n  public readonly options$: BehaviorSubject<O>;\n  public readonly end$ = new Subject();\n\n  public content: T[] = [];\n  public page = -1;\n  public totalPages = 1;\n\n  private readonly fetchCommand$: Subject<never> = new Subject<never>();\n\n  constructor(\n    private readonly fetchNextFn$: (page: number, options: O) => Observable<IPageResponse<T>>,\n    options: O = null\n  ) {\n    this.options$ = new BehaviorSubject<O>(options);\n    this.fetchCommand$.pipe(debounce(() => this.isFetching$.pipe(filter((_: boolean) => !_)))).subscribe(() => this.fetchNextPage());\n  }\n\n  public fetch(): void {\n    if (this.page < this.totalPages - 1) {\n      this.fetchCommand$.next();\n    }\n  }\n\n  public reset$(hard: boolean = true): Observable<any> {\n    return this.isFetching$.pipe(\n      filter((it: boolean) => !it),\n      first(),\n      tap(() => {\n        if (hard) {\n          this.content.splice(0, this.content.length);\n        }\n        this.page = -1;\n        this.totalPages = 1;\n      }),\n    );\n  }\n\n  public setOptionsWithReset$(options: O, hard: boolean = true): Observable<O> {\n    return this.reset$(hard).pipe(\n      tap(() => {\n        this.options$.next(options);\n        this.fetch();\n      }),\n      mapTo(options),\n    );\n  }\n\n  private fetchNextPage(): void {\n    this.isFetching$.next(true);\n    this.fetchNextFn$(this.page + 1, this.options$.value).subscribe(\n      (response: IPageResponse<T>) => {\n        this.page = response.page;\n        this.totalPages = response.totalPages;\n        this.content$.next(response.content);\n        if (this.page >= this.totalPages - 1) {\n          this.end$.next();\n        }\n        this.content.push(...response.content);\n        this.isFetching$.next(false);\n      },\n      (error: any) => {\n        this.isFetching$.next(false);\n        if (error !== Symbol('NO_CONTENT')) {\n          throw error;\n        }\n      },\n    );\n  }\n}\n"]}